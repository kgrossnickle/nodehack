extends layout
block content
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pikaday/1.6.1/pikaday.js"></script>
  <script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/pikaday/1.6.1/css/pikaday.min.css">
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.19/css/dataTables.bootstrap4.min.css">
    head-search(id="mainDiv" style="position:relative;top:0px;left:0px;margin-bottom:2px;padding:50px;width: 100vw;margin-left:calc(-50vw + 50%);background-image:url('img/sb2 (1).png');background-size:     cover; background-repeat:   no-repeat;background-position: center center;   display: flex;justify-content: center;align-items: center; ")
      .search(style="background:rgba(0, 0, 0, .4);color:white;display: inline-block; border-radius: 25px; width:80%;   padding: 15px;margin-top:10px;margin-bottom:5px;    justify-content: center;  ")     
        form( style="margin-left:10%;" )
          input(type='hidden', name='_csrf', value=_csrf)
          .form-group.row
            label(class='col-md-2 col-form-label font-weight-bold', for='From' style="width:90%;text-align:center;") From
            .col-md-8
              input.form-control( type="text" name="r16R71!" autocomplete="false" style="width:90%;text-align:center;" placeholder="From")
          .form-group.row
            label(class='col-md-2 col-form-label font-weight-bold', for='To' style="width:90%;text-align:center;" ) To
            .col-md-8
              input.form-control(type='text', name='r16R71', id='name', autocomplete="false" style="width:90%;text-align:center;" placeholder="To")
          .form-group.row
            label(class='col-md-2 col-form-label font-weight-bold', for='Depart' style="width:90%;text-align:center;") Depart
            .col-md-8
                input.form-control(type='text', name='r16R71', id="depart", autocomplete="false" style="width:90%;text-align:center;") 
          .form-group.row
            label(class='col-md-2 col-form-label font-weight-bold', for='Return' style="width:90%;text-align:center;") Return
            .col-md-8
                input.form-control(type='none', name='r16R71', id='return', autocomplete="false" style="width:90%;text-align:center;")
        div(style="  text-align: center;margin-top:8px;")
          button.btn.btn-lg.btn-primary(style="margin-right:5px;" onclick='showTrips()') Go 
            i.fas.fa-plane
          button.btn.btn-lg.btn-primary(id="showmapbutton" onclick="showmap()") Use Map 
                i.fas.fa-globe-americas
  .card(style='background-color: #000') 
  center <div id="map"  style="height:400px;margin-top: 00px;:both;"></div>

  script.
      var mapHidden = true;
      $("#depart").attr("placeholder", moment().format('Do MMMM YYYY')).val("").focus().blur();
      $("#return").attr("placeholder", moment().day(+7).format('Do MMMM YYYY')).val("").focus().blur();
      var pickerDepart = new Pikaday({
          field: document.getElementById('depart'),
          format: 'D MMM YYYY',
          placeholder: "fdjnf",
          onSelect: function() {
              console.log(this.getMoment().format('Do MMMM YYYY'));
          }
      });
      var pickerReturn = new Pikaday({
          field: document.getElementById('return'),
          format: 'D MMM YYYY',
          onSelect: function() {
              console.log(this.getMoment().format('Do MMMM YYYY'));
          }
      });
    $(document).ready(function() { 
      $.noConflict();
      $( "#trips" ).hide();
      $( "#map" ).hide();
      $('#price_table').DataTable();
      $("#price_table").hide();
     });
     function showmap(){
       if(mapHidden){
        $( "#map" ).show();
        $('html, body').animate({
            scrollTop: $("#map").offset().top- 40
          }, 1000);
        $("#showmapbutton").html('Hide Map');
        mapHidden = false;
       }
        else{
          $( "#map" ).hide();
          $('html, body').animate({
            scrollTop: $("#trips").offset().top
          }, 1000);
          $("#showmapbutton").html('Hide Map');
          mapHidden=true;
        }

     }
      var rectangle;
      var rectangle2;
      var map;
      var infoWindow;
      var infoWindow2;

      function initMap() {
        var bounds = {
          north: 28.4524,
          south: 26.043,
          east:   -79.606,
          west:  -81.99
        };
        var bounds2 = {
          north: 46.8000,
          south: 35.44875340,
          east:  -100.54058,
          west:  -116.20466
        };

        // Define the rectangle and set its editable property to true.
        // Define an info window on the map.
        map = new google.maps.Map(document.getElementById('map'), {
          center: {lat: 38.610988647725, lng: -92.4499},
          zoom: 4
        });

        // Define the rectangle and set its editable property to true.
        rectangle = new google.maps.Rectangle({
          strokeColor: '#2365ff',
          strokeOpacity: 0.8,
          strokeWeight: 2,
          fillColor: '#2365ff',
          fillOpacity: 0.35,
          bounds: bounds,
          editable: true,
          draggable: true
        });
        rectangle2 = new google.maps.Rectangle({
          strokeColor: '#FF0000',
          strokeOpacity: 0.8,
          strokeWeight: 2,
          fillColor: '#FF0000',
          fillOpacity: 0.35,
          bounds: bounds2,
          editable: true,
          draggable: true
        });

        rectangle.setMap(map);

        // Add an event listener on the rectangle.
        rectangle.addListener('bounds_changed', showNewRect);
        rectangle2.setMap(map);

        // Add an event listener on the rectangle.
        rectangle2.addListener('bounds_changed', showNewRect2);
        // Define an info window on the map.
        infoWindow = new google.maps.InfoWindow();
        infoWindow2 = new google.maps.InfoWindow();
      }
      // Show the new coordinates for the rectangle in an info window.

      /** @this {google.maps.Rectangle} */
      function showNewRect(event) {
        var ne = rectangle.getBounds().getNorthEast();
        var sw = rectangle.getBounds().getSouthWest();

        var contentString = '<b>Rectangle moved.</b><br>' +
            'New north-east corner: ' + ne.lat() + ', ' + ne.lng() + '<br>' +
            'New south-west corner: ' + sw.lat() + ', ' + sw.lng();

        // Set the info window's content and position.
        infoWindow.setContent(contentString);
        infoWindow.setPosition(ne);

        infoWindow.open(map);
      }
      function showNewRect2(event) {
        var ne2 = rectangle2.getBounds().getNorthEast();
        var sw2 = rectangle2.getBounds().getSouthWest();

        var contentString2 = '<b>Rectangle moved.</b><br>' +
            'New north-east corner: ' + ne2.lat() + ', ' + ne2.lng() + '<br>' +
            'New south-west corner: ' + sw2.lat() + ', ' + sw2.lng();
        // Set the info window's content and position.
        infoWindow2.setContent(contentString2);
        infoWindow2.setPosition(ne2);

        infoWindow2.open(map);
      }

  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDuehQ2KPVZ3fVpvhzyVpEYI9QntDN5DOE&callback=initMap">
  </script>

  #trips(style = "height:800px;margin-top:40px;")
    h2 
      center(id="loadTrips-Text") Loading Trips
    <div class="sk-wandering-cubes" id="loading">
        <div class="sk-cube sk-cube1"></div>
        <div class="sk-cube sk-cube2"></div>
    </div>
    <table id="price_table" class="table table-striped table-bordered" style="width:100%">
        <thead>
            <tr>
                <th>Price</th>
                <th>Airline(s)</th>
                <th>Flight Time</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
        <!--tfoot>
            <tr>
                <th>Price</th>
                <th>Airline(s)</th>
                <th>Flight Time</th>
            </tr>
        </tfoot-->
    </table>
    <pre></pre>
    script.
      function showTrips(){
        $( "#trips" ).show();
        //$( "#mainDiv" ).hide();
        $('html, body').animate({
          scrollTop: $("#trips").offset().top- 80
        }, 1000);
        loadTrips();
      }
      function loadTrips(){
          $.ajax({
            url: 'https://api.skypicker.com/flights?flyFrom=PRG&to=LGW&dateFrom=18/11/2018&dateTo=12/12/2018&partner=picky',
            type: "GET",
            dataType: "json",
            success: function (data) {
                showFlights(data);
           }
        });

      }

      function showFlights(data){
                $( "#loading" ).hide();
                $('#loadTrips-Text').text("Flights")
                for(var i =0;i<data.data.length;i++){
                  var time = (data.data[i].duration.total/(60*60));
                  time = time.toString().substring(0, 4)+" Hours";
                  $('#price_table').DataTable().row.add([
                    "$"+data.data[i].price, data.data[i].airlines, time
                  ]).draw();
                }
                $("#price_table").show();
                $('pre').html(JSON.stringify(data, undefined, 2));
      }


